{"ast":null,"code":"import axios from \"axios\";\nimport { url } from \"./API\";\nimport jwtDecode from \"jwt-decode\";\nconst {\n  createSlice,\n  createAsyncThunk\n} = require(\"@reduxjs/toolkit\");\nconst initialState = {\n  token: localStorage.getItem(\"token\"),\n  name: \"\",\n  email: \"\",\n  id: \"\",\n  registerStatus: \"\",\n  registerError: \"\",\n  loginStatus: \"\",\n  loginError: \"\",\n  userLoaded: false\n};\nexport const registerUser = createAsyncThunk(\"auth/registerUser\", async (user, _ref) => {\n  let {\n    rejectWithValue\n  } = _ref;\n  try {\n    const token = await axios.post(`${url}/register`, {\n      name: user.name,\n      email: user.email,\n      password: user.password\n    });\n    localStorage.setItem(\"token\", token.data);\n    return token.data;\n  } catch (error) {\n    console.log(error.response.data);\n    return rejectWithValue();\n  }\n});\nconst authSlice = createSlice({\n  name: \"auth\",\n  initialState,\n  reducers: {\n    loadUser(state, action) {\n      const token = state.token;\n      if (token) {\n        const user = jwtDecode(token);\n        return {\n          ...state,\n          token,\n          name: user.name,\n          email: user.email,\n          id: user.id,\n          userLoaded: true\n        };\n      }\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(registerUser.pending, (state, action) => {\n      return {\n        ...state,\n        registerStatus: \"pending\"\n      };\n    });\n    builder.addCase(registerUser.fulfilled, (state, action) => {\n      if (action.payload) {\n        const user = jwtDecode(action.payload);\n        return {\n          ...state,\n          token: action.payload,\n          name: user.name,\n          email: user.email,\n          id: user.id,\n          registerStatus: \"success\"\n        };\n      } else return state;\n    });\n    builder.addCase(registerUser.rejected, (state, action) => {\n      return {\n        ...state,\n        registerStatus: \"rejected\",\n        registerError: action.payload\n      };\n    });\n  }\n});\nexport const {\n  loadUser,\n  logout\n} = authSlice.actions;\nexport default authSlice.reducer;","map":{"version":3,"names":["axios","url","jwtDecode","createSlice","createAsyncThunk","require","initialState","token","localStorage","getItem","name","email","id","registerStatus","registerError","loginStatus","loginError","userLoaded","registerUser","user","_ref","rejectWithValue","post","password","setItem","data","error","console","log","response","authSlice","reducers","loadUser","state","action","extraReducers","builder","addCase","pending","fulfilled","payload","rejected","logout","actions","reducer"],"sources":["/Users/nivporat/Desktop/mepelaozen/src/components/store/AuthSlice.js"],"sourcesContent":["import axios from \"axios\";\nimport { url } from \"./API\";\nimport jwtDecode from \"jwt-decode\";\n\nconst { createSlice, createAsyncThunk } = require(\"@reduxjs/toolkit\");\n\n\n const initialState = {\n    token: localStorage.getItem(\"token\"),\n    name:\"\",\n    email:\"\",\n    id:\"\",\n    registerStatus:\"\",\n    registerError:\"\",\n    loginStatus:\"\",\n    loginError:\"\",\n    userLoaded:false,\n}\n\n\n\nexport const registerUser =  createAsyncThunk(\n    \"auth/registerUser\",\n   async (user,{rejectWithValue}) => {\n        try {\n        const token = await axios.post(`${url}/register`,{\n                name:user.name,\n                email:user.email,\n                password:user.password\n            })\n            localStorage.setItem(\"token\",token.data)    \n            return token.data\n        } catch (error) {\n            console.log(error.response.data)\n           return rejectWithValue()\n        }\n    }\n)\n\n\n\nconst authSlice = createSlice({\n    name:\"auth\",\n    initialState,\n    reducers:{\n        loadUser(state,action){\n            const token = state.token\n            if(token){\n                const user = jwtDecode(token)\n                return{\n                    ...state,\n                    token,\n                    name:user.name,\n                    email:user.email,\n                    id:user.id,\n                    userLoaded:true\n                }\n            }\n        }\n    },\n\n    extraReducers:(builder)=>{\n        builder.addCase(registerUser.pending,(state,action)=>{\n                return { ...state,registerStatus:\"pending\"}\n        })\n\n        builder.addCase(registerUser.fulfilled,(state,action)=>{\n            if(action.payload){\n                const user = jwtDecode(action.payload)\n                    return{\n                        ...state,\n                        token:action.payload,\n                        name:user.name,\n                        email:user.email,\n                        id:user.id,\n                        registerStatus:\"success\"\n                    }\n            }else return state\n        })\n\n\n        builder.addCase(registerUser.rejected,(state,action)=>{\n            return{\n                ...state,\n                registerStatus:\"rejected\",\n                registerError:action.payload\n            }\n        })\n    }\n})\n\n\nexport const {loadUser,logout} = authSlice.actions\nexport default authSlice.reducer"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}